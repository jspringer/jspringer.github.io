<!-- Submit to us a deliverable of your choice that configures a Bread button with the following characteristics:
✓ One product costing $100 is to be purchased
✓ There is both a 2-day and an overnight shipping option available for this product
✓ The tax charged to a purchaser should be 5% if the shipping address supplied by
the customer within the Bread checkout flow is in the state of NY, otherwise tax
should be 0
✓ Since this test merchant is pre-configured in Bread’s system with loan offerings,
we are able to display an “as low as $” number on the Bread button - show this.
✓ The button should always be a clickable button, whether or not a user is logged
in
- When a user has completed a full checkout, they should receive a success
message (if approved to proceed).
✓ If a user closes the form without completing the checkout:
✓ If declined, they should receive an appropriate message
✓ If approved, the customer should receive an appropriate message 
✓ The color of the text font within the Bread button should be red

Sandbox API notes:
• Use a random and unique phone number (mash the keys, essentially)
• When inputting last 4 digits of a fake SSN: input the last 4 digits as 0800.
• Instead of a texted one-time password, use code 1234567 when prompted to
authenticate.
• After completing the checkout process, the bread button is replaced with a "$ per
month". Mouse over the tooltip and click "Not you.. click here" to reset the button. -->

<html>
  <head>
    <title>Toasty Electronics: Checkout</title>
    <script src="https://checkout-sandbox.getbread.com/bread.js" data-api-key="7101ea30-8ae3-47ab-a8bd-235860d36f3e"></script>

    <style type="text/css">
      body { 
        background: #ffffff; 
        font-size: 14pt; 
        line-height: 1.25; 
        color: #434242; 
        font-family: 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif; 
        font-weight: 300; 
      }

      /* #bread-checkout-btn, #checkout-form, #bread-checkout-btn-bread-iframe {
        color: red !important;
      } */

    </style>
  </head>
  <body>
    <h1>Toasty Electronics</h1>
    <p><strong>Cart:</strong></p>
    <div>
      <p>1 x iPhone 8 (Rose Gold, 256GB)</p>
      <a href="https://www.macrumors.com/roundup/iphone-8/"><img src="http://jasonspringer.me/apps/bread/checkout/iphone8.jpg" style="width: 300px" /></a>
      <p><strong>Subtotal (Pre-Tax):</strong> $100.00</p>
    </div>

    <p><strong>Checkout:</strong></p>

    <form id="checkout-form" action="checkout" method="post">

      <div id="bread-checkout-btn" data-bread-default-size=true></div>
      
    </form>

    <script type='text/javascript'>
      var items = [{
          name: "iPhone 8 (Rose Gold, 256GB)",
          price: 10000,
          sku:" IPH08RG256",
          imageUrl: "http://jasonspringer.me/apps/bread/checkout/iphone8.jpg",
          detailUrl: "https://www.macrumors.com/roundup/iphone-8/",
          quantity: 1
        }];

      /* cart.products.forEach(function (p) {
        items.push(
          {
            name: p.name,                       // required
            price: parseInt( (p.price * 100) ), // required (value in cents USD)
            sku: p.sku,                         // required
            imageUrl: p.imgUrl,                 // optional
            detailUrl: p.detailUrl,             // required
            quantity: parseInt(p.quantity)      // required
          }
        );
      });*/

      var shippingContact = {
        fullName: 'Jason Springer',
        address:  '1 Metropolitan Avenue',
        address2: 'Apt 3',
        city:     'Brooklyn',
        state:    'NY',
        zip:      '11211',
        phone:    '1234567890',
        email:    'jasonspringer@aol.com'
      };

      var billingContact = {
        firstName: 'Jason',
        lastName: 'Springer',
        address:  '1 Metropolitan Avenue',
        address2: 'Apt 3',
        city:     'Brooklyn',
        state:    'NY',
        zip:      '11211',
        phone:    '1234567890',
        email:    'jasonspringer@aol.com'
      };

      var opts = {
        buttonId: 'bread-checkout-btn',
        items: items,
        actAsLabel: false,
        shippingContact: shippingContact,
        billingContact: billingContact,
        asLowAs: true,
        shippingOptions: [
          {
            type: '2 Day Delivery',
            typeId: 'UPS_2DAY',
            cost: 1200
          }, 
          {
            type: 'Overnight Delivery',
            typeId: 'UPS_1DAY',
            cost: 1800
          }
        ],
        calculateTax: function(shippingContact, callback) {
            var itemsTotal = 0;
            var nyTaxRate = 0.05;
            var taxRate = 0;
            // if we can use es6+ JS, I'd use: for...of and use let/const instead of var - Jason
            for (var i = 0; i < items.length; i++) {
              itemsTotal += items[i].price * items[i].quantity;
            }
            if (shippingContact.state === 'NY') {
                return (itemsTotal * nyTaxRate);
              } else {
                return taxRate;
            }
          // If I was running a server, the following would be used instead of the if statement above - Jason
          /* $.ajax({
            url: '/tax',
            type: 'POST',
            data: {shipping: shippingContact, total: itemsTotal} 
          }).done(function(data){
            if (data.error !== undefined) {
              callback(new Error("Tax Error"));
            } else {
              callback(null, data.tax);
            }
          }); */
        }, 
        onCustomerClose: function(err, custData) {
          if (err !== null) {
            console.error("An error occurred getting customer close data.");
            return;
          }

          var customerEmail = custData.email;
          var qualState     = custData.state;
          switch (qualState) {
            case 'PREQUALIFIED':
              console.log(customerEmail + " was prequalified for financing.");
            break;

            case 'PARTIALLY_PREQUALIFIED':
              console.log(customerEmail + " was partially prequalified for financing.");
            break;

            case 'NOT_PREQUALIFIED':
              console.log(customerEmail + " was not prequalified for financing.");
            break;

            case 'ABANDONED':
              if (customerEmail === undefined || customerEmail === null) {
                console.log("Unknown customer abandoned their prequalification attempt.");
              } else {
                console.log(customerEmail + " abandoned their prequalification attempt.");
              }
            break;
          }
        }, 
      customCSS: "#bread-button,body,html{height:100%;margin:0;width:100%}body{display:table}#bread-button{background-image:url('http://jasonspringer.me/apps/bread/checkout/breadicon.png');background-size:contain;color:red;display:table-cell;font-size:14px;text-align:center;vertical-align:middle}.bread-btn{cursor:pointer}.bread-embed-inner,.bread-label .bread-embed-icon{display:inline-block}.bread-label .bread-embed-icon:after{background:rgba(255,255,255,.5);border-radius:50px;color:#333;content:'i';cursor:pointer;display:inline-block;line-height:1;margin-left:8px;padding:4px 9px}.bread-pot:before{content:'Pay Over Time'}.bread-btn .bread-as-low-as:before,.bread-label .bread-as-low-as:before{content:'As low as '}.bread-for:before{content:'For '}" 
      }; // end of opts

      bread.checkout(opts);
    </script>
    </div>
  </body>
</html>